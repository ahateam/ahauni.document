<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小红椒后端交接文档 | AHA-uniapp项目指南</title>
    <meta name="description" content="Technology pursues art and art challenges technology">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <link rel="icon" href="./hero.png">
    
    <link rel="preload" href="/document/assets/css/0.styles.e5289fa1.css" as="style"><link rel="preload" href="/document/assets/js/app.3d2e3ff9.js" as="script"><link rel="preload" href="/document/assets/js/3.b3d74ef6.js" as="script"><link rel="preload" href="/document/assets/js/1.548067c8.js" as="script"><link rel="preload" href="/document/assets/js/17.57674d0d.js" as="script"><link rel="prefetch" href="/document/assets/js/10.8415833d.js"><link rel="prefetch" href="/document/assets/js/11.60614edf.js"><link rel="prefetch" href="/document/assets/js/12.1c9b76dd.js"><link rel="prefetch" href="/document/assets/js/13.affd0f30.js"><link rel="prefetch" href="/document/assets/js/14.ecbdb331.js"><link rel="prefetch" href="/document/assets/js/15.35053f9f.js"><link rel="prefetch" href="/document/assets/js/16.999a1852.js"><link rel="prefetch" href="/document/assets/js/18.bcf679be.js"><link rel="prefetch" href="/document/assets/js/19.ea5586e8.js"><link rel="prefetch" href="/document/assets/js/20.2838b2cf.js"><link rel="prefetch" href="/document/assets/js/21.542de3cc.js"><link rel="prefetch" href="/document/assets/js/22.72e6f0a6.js"><link rel="prefetch" href="/document/assets/js/23.0d261c5d.js"><link rel="prefetch" href="/document/assets/js/24.27e357b6.js"><link rel="prefetch" href="/document/assets/js/25.1d0401e2.js"><link rel="prefetch" href="/document/assets/js/26.54bb6ff9.js"><link rel="prefetch" href="/document/assets/js/27.41645315.js"><link rel="prefetch" href="/document/assets/js/28.17e6b5a9.js"><link rel="prefetch" href="/document/assets/js/29.b017413b.js"><link rel="prefetch" href="/document/assets/js/30.892aba32.js"><link rel="prefetch" href="/document/assets/js/31.abd0b240.js"><link rel="prefetch" href="/document/assets/js/32.a51cbf4a.js"><link rel="prefetch" href="/document/assets/js/33.d7ae0878.js"><link rel="prefetch" href="/document/assets/js/34.1cff083e.js"><link rel="prefetch" href="/document/assets/js/35.c7d6813a.js"><link rel="prefetch" href="/document/assets/js/36.1f232d71.js"><link rel="prefetch" href="/document/assets/js/37.540a0abe.js"><link rel="prefetch" href="/document/assets/js/38.93514d02.js"><link rel="prefetch" href="/document/assets/js/4.6e82a290.js"><link rel="prefetch" href="/document/assets/js/5.dadf3afc.js"><link rel="prefetch" href="/document/assets/js/6.2393e597.js"><link rel="prefetch" href="/document/assets/js/7.f3f6714f.js"><link rel="prefetch" href="/document/assets/js/8.1791c85f.js"><link rel="prefetch" href="/document/assets/js/9.8f5f4ca6.js">
    <link rel="stylesheet" href="/document/assets/css/0.styles.e5289fa1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><div><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/document/" class="home-link router-link-active"><!----> <span class="site-name">AHA-uniapp项目指南</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox" checked="checked"></div></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/document/aha/info/" class="nav-link"><i class="iconfont undefined"></i>
  aha-uniapp
</a></div><div class="nav-item"><a href="/document/aha-element/" class="nav-link"><i class="iconfont undefined"></i>
  aha-element
</a></div><div class="nav-item"><a href="/document/jiti-uniapp/info/" class="nav-link"><i class="iconfont undefined"></i>
  集体经济
</a></div><div class="nav-item"><a href="/document/kk-uniapp/info/" class="nav-link"><i class="iconfont undefined"></i>
  夸夸uniapp
</a></div><div class="nav-item"><a href="/document/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他项目
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      关于项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/about/info/write.html" class="nav-link"><i class="iconfont undefined"></i>
  文档介绍
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/ahateam/aha-uniapp.git" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  项目GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/document/aha/info/" class="nav-link"><i class="iconfont undefined"></i>
  aha-uniapp
</a></div><div class="nav-item"><a href="/document/aha-element/" class="nav-link"><i class="iconfont undefined"></i>
  aha-element
</a></div><div class="nav-item"><a href="/document/jiti-uniapp/info/" class="nav-link"><i class="iconfont undefined"></i>
  集体经济
</a></div><div class="nav-item"><a href="/document/kk-uniapp/info/" class="nav-link"><i class="iconfont undefined"></i>
  夸夸uniapp
</a></div><div class="nav-item"><a href="/document/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他项目
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      关于项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/about/info/write.html" class="nav-link"><i class="iconfont undefined"></i>
  文档介绍
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/ahateam/aha-uniapp.git" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  项目GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/document/aha/normal/normal.html" class="sidebar-link">小红椒前端AHA团队代码规范</a></li><li><a href="/document/aha/info/" class="sidebar-link">aha-uniapp 框架指南</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>后端文档</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/aha/back/example.html" class="active sidebar-link">小红椒后端交接文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/aha/back/example.html#" class="sidebar-link"></a></li></ul></li><li><a href="/document/aha/back/contentModule.html" class="sidebar-link">内容模块文档/三方登录</a></li></ul></section></li></ul> </aside> <div><main class="page reco-hide"> <div class="page-title"><h1>小红椒后端交接文档</h1> <hr> <div data-v-362e684e><i class="iconfont reco-account" data-v-362e684e><span data-v-362e684e>JXians</span></i> <i class="iconfont reco-date" data-v-362e684e><span data-v-362e684e>2019-12-11</span></i> <!----> <!----></div></div> <div class="content__default"><p>##流程引擎</p> <p>运行环境：Java1.8、MySQL5.7</p> <h3 id="_1、前言现状"><a href="#_1、前言现状" aria-hidden="true" class="header-anchor">#</a> 1、前言现状</h3> <p>​	现在的OA系统中的流程实现都很单一，为了让OA系统中的流程更灵活多变，公司决定编写一套流程引擎。</p> <p>目前流程引擎设计与初步后端代码实现已完成，待实战调试。</p> <h3 id="_2、实现思路"><a href="#_2、实现思路" aria-hidden="true" class="header-anchor">#</a> 2、实现思路</h3> <p>** 主要表设计：</p> <ul><li><p>流程定义表（ProcessDefinition）</p></li> <li><p>节点分组表（ProcessActivityGroup）</p></li> <li><p>节点表（ProcessActivity）</p></li> <li><p>行为表（ProcessAction）</p></li> <li><p>资产定义表（ProcessAssetDesc）</p></li> <li><p>资产表（ProcessAsset）</p></li> <li><p>流程实例表（Process）</p></li> <li><p>附件表（Annex）</p></li> <li><p>流程实例日志表（ProcessLog）</p></li> <li><p>表结构表（Tableschema）</p></li> <li><p>表数据表（TableData）</p></li> <li><p>表数据批次表（TableBatch）</p></li> <li><p>表批次数据表（TableBatchData）</p></li> <li><p>** 代码实现流程图——流程定义：**</p></li></ul> <p><strong>代码包：zyxhj.flow.service/FlowService</strong></p> <p><img src="https://ahateam.github.io/document/aha/back/%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89.png" alt=""></p> <p><strong>代码实现流程图——流程实例（不完整）：</strong></p> <p><strong>代码包：zyxhj.flow.service/ProcessService</strong></p> <p><img src="https://ahateam.github.io/document/aha/back/%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B.png" alt=""></p> <p><strong>流程实例运行核心代码（execAction）：</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@POSTAPI</span><span class="token punctuation">(</span><span class="token comment">//</span>
    path <span class="token operator">=</span> <span class="token string">&quot;execAction&quot;</span><span class="token punctuation">,</span> <span class="token comment">//</span>
    des <span class="token operator">=</span> <span class="token string">&quot;执行action&quot;</span><span class="token punctuation">,</span> <span class="token comment">//</span>
    ret <span class="token operator">=</span> <span class="token string">&quot;受影响行数&quot;</span><span class="token comment">//</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">execAction</span><span class="token punctuation">(</span><span class="token comment">//</span>
    <span class="token annotation punctuation">@P</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token string">&quot;流程实例行为编号，&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> processId<span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token annotation punctuation">@P</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token string">&quot;节点行为编号，&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> activityId<span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token annotation punctuation">@P</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token string">&quot;action行为编号，&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> actionId<span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token annotation punctuation">@P</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token string">&quot;节点分组编号，&quot;</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> activityGroupId<span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token annotation punctuation">@P</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token string">&quot;使用者编号，&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token annotation punctuation">@P</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token string">&quot;行为类型，&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> type<span class="token comment">//</span>
<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">DruidPooledConnection</span> conn <span class="token operator">=</span> ds<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// processActionIF 是 判断实例、节点、action是否存在</span>
        <span class="token class-name">ProcessAction</span> action <span class="token operator">=</span> <span class="token function">processActionIF</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> activityId<span class="token punctuation">,</span> actionId<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> EXP<span class="token punctuation">.</span><span class="token function">INS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 目标节点</span>
            <span class="token class-name">String</span> defaultTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token comment">// 判断rule</span>
            <span class="token class-name">JSONArray</span> rules <span class="token operator">=</span> action<span class="token punctuation">.</span>rules<span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rules<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token class-name">JSONObject</span> jo <span class="token operator">=</span> rules<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> exp <span class="token operator">=</span> jo<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;exp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> targetType <span class="token operator">=</span> jo<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;targetType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> target <span class="token operator">=</span> jo<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 是节点还是节点分组</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>targetType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;activity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token comment">// 普通节点还是节点分组内节点</span>
                    <span class="token class-name">ProcessActivity</span> activity <span class="token operator">=</span> flowService<span class="token punctuation">.</span><span class="token function">getPDActivityById</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>pdId<span class="token punctuation">,</span> activityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>activity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>activity<span class="token punctuation">.</span>activityGroupId <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> activity<span class="token punctuation">.</span>activityGroupId <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入普通节点&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// 执行表达式 得到下一目标节点</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>exp<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;expDefault&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token comment">// 默认case</span>
                                defaultTarget <span class="token operator">=</span> target<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                <span class="token comment">// 其它case，先判断表达式，然后执行</span>
                            <span class="token punctuation">}</span>
                            <span class="token comment">// 修改action中的ext数据</span>
                            ret <span class="token operator">=</span> <span class="token function">editActionExt</span><span class="token punctuation">(</span>actionId<span class="token punctuation">,</span> activityId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Byte</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入节点分组内节点&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">// 修改action中的ext数据</span>
                            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessAction</span><span class="token punctuation">&gt;</span></span> palist <span class="token operator">=</span> <span class="token function">getProcessActionsInActivity</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">Long</span> currId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessAction</span> p <span class="token operator">:</span> palist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    currId <span class="token operator">=</span> p<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
                                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;currId&quot;</span> <span class="token operator">+</span> currId<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token keyword">int</span> edit <span class="token operator">=</span> <span class="token function">editActionExt</span><span class="token punctuation">(</span>currId<span class="token punctuation">,</span> activityId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Byte</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;修改action状态&quot;</span> <span class="token operator">+</span> edit<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">// 查询当前节点分组中所有节点是否全部执行完毕</span>
                            ret <span class="token operator">=</span> <span class="token function">ifActivityAction</span><span class="token punctuation">(</span>activityGroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前节点分组编号：&quot;</span> <span class="token operator">+</span> activityGroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token keyword">int</span> subSize <span class="token operator">=</span> flowService<span class="token punctuation">.</span><span class="token function">getSubActivity</span><span class="token punctuation">(</span>activityGroupId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> subSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;所有操作均完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token comment">// 得到相应操作的节点分组action</span>
                                <span class="token class-name">ProcessAction</span> paglist <span class="token operator">=</span> processActionRepository<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>
                                                                                    EXP<span class="token punctuation">.</span><span class="token function">INS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token string">&quot;owner_id&quot;</span><span class="token punctuation">,</span> activityGroupId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andKey</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token class-name">JSONArray</span> ja <span class="token operator">=</span> paglist<span class="token punctuation">.</span>rules<span class="token punctuation">;</span>
                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> ja<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token class-name">JSONObject</span> jo1 <span class="token operator">=</span> ja<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token class-name">String</span> exp1 <span class="token operator">=</span> jo1<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;exp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token class-name">String</span> target1 <span class="token operator">=</span> jo1<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>exp1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;expDefault&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token comment">// 默认case</span>
                                        defaultTarget <span class="token operator">=</span> target1<span class="token punctuation">;</span>
                                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                        <span class="token comment">// 其它case，先判断表达式，然后执行</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;操作未完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                defaultTarget <span class="token operator">=</span> activityGroupId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;分组内节点跳转目标&quot;</span> <span class="token operator">+</span> defaultTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>targetType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;activityGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//						target = jo.getString(&quot;target&quot;);</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入节点分组&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 执行表达式 得到下一目标节点</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>exp<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;expDefault&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 默认case</span>
                        defaultTarget <span class="token operator">=</span> target<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 其它case，先判断表达式，然后执行</span>
                    <span class="token punctuation">}</span>
                    ret <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------------------&quot;</span> <span class="token operator">+</span> defaultTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 流程实例跳转到下一目标节点</span>
            <span class="token class-name">Process</span> renew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultTarget <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                renew<span class="token punctuation">.</span>currActivityId <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                renew<span class="token punctuation">.</span>currActivityId <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>defaultTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            processRepository<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> EXP<span class="token punctuation">.</span><span class="token function">INS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> processId<span class="token punctuation">)</span><span class="token punctuation">,</span> renew<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 记录日志</span>
            <span class="token function">createProcessLog</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> <span class="token string">&quot;action操作&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> action<span class="token punctuation">.</span>type<span class="token punctuation">,</span> action<span class="token punctuation">.</span>label<span class="token punctuation">,</span> activityId<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServerException</span><span class="token punctuation">(</span><span class="token class-name">BaseRC</span><span class="token punctuation">.</span>SERVER_DEFAULT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;没找到对应流程节点的行为Action&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>批次数据导入处理流程图（初步设计）：</strong></p> <p><strong>代码包：zyxhj.flow.service/TableService</strong></p> <p><img src="https://ahateam.github.io/document/aha/back/%E8%A1%A8%E6%A0%BC%E5%BC%95%E6%93%8E-%E6%89%B9%E6%AC%A1.png" alt=""></p> <h3 id="_3、代码地址"><a href="#_3、代码地址" aria-hidden="true" class="header-anchor">#</a> 3、代码地址</h3> <div class="language-http extra-class"><pre class="language-http"><code> https://github.com/ahateam/zero/tree/dev 
</code></pre></div><h3 id="_4、备注"><a href="#_4、备注" aria-hidden="true" class="header-anchor">#</a> 4、备注</h3> <div class="language-properties extra-class"><pre class="language-properties"><code>技术开发：张宇、郑兴江
技术维护：张宇、郑兴江
联系方式：18685644226(QQ)
项目保管：小红椒-刘滔
<span class="token attr-name">项目地址：</span> <span class="token attr-value">https://github.com/ahateam/zero/tree/dev</span>
是否维护：否/是
停止维护：2019/12/11
</code></pre></div><p>##工具类</p> <h3 id="_1、榴莲项目合同生成工具类"><a href="#_1、榴莲项目合同生成工具类" aria-hidden="true" class="header-anchor">#</a> 1、榴莲项目合同生成工具类</h3> <p>​	<strong>代码包：zyxhj.utils/ExportOfficeUtils</strong></p> <p>​	<strong>Word、PDF文档生成SDK</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- docx4j 生成PDF使用 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.docx4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>docx4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.xmlgraphics<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>batik-util<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.docx4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>docx4j-export-fo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- freemarker --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.xhtmlrenderer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flying-saucer-pdf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>9.1.19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>word文档生成</strong></p> <p>使用方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ExportOfficeUtils</span><span class="token punctuation">.</span><span class="token function">generateWORD</span><span class="token punctuation">(</span>templateName<span class="token punctuation">,</span> map<span class="token punctuation">,</span> <span class="token class-name">OutputFilePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
  * 根据模板生成word文档
  * 
  * @param templateName   模板名称
  * @param dataMap        模板需求数据
  * @param OutputFilePath 生成文件存放地址
  */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">generateWORD</span><span class="token punctuation">(</span><span class="token class-name">String</span> templateName<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap<span class="token punctuation">,</span> <span class="token class-name">String</span> <span class="token class-name">OutputFilePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// Configuration 用于读取ftl文件</span>
        <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出文档路径及名称</span>
        <span class="token class-name">File</span> outFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">OutputFilePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Template</span> template <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getTemplate</span><span class="token punctuation">(</span>templateName<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Writer</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>outFile<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10240</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>PDF文档生成</strong></p> <p>使用方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ExportOfficeUtils</span><span class="token punctuation">.</span><span class="token function">generateWORD</span><span class="token punctuation">(</span>templateName<span class="token punctuation">,</span> map<span class="token punctuation">,</span> <span class="token class-name">WORDoutputFilePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
  * 生成pdf文档
  * 
  * @param templateName 模版文件
  * @param obj          数据
  * @param os           输出流
  * @throws Exception 
  */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">generatePDF</span><span class="token punctuation">(</span><span class="token class-name">String</span> templateName<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap<span class="token punctuation">,</span> <span class="token class-name">String</span> <span class="token class-name">PDFoutputFilePath</span><span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 合并模板和数据模型 word doc os = ftl + obj</span>
    <span class="token class-name">String</span> generate <span class="token operator">=</span> <span class="token class-name">ExportOfficeUtils</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>templateName<span class="token punctuation">,</span> dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ByteArrayInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>generate<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 文字处理对象</span>
    <span class="token class-name">WordprocessingMLPackage</span> wordMLPackage <span class="token operator">=</span> <span class="token class-name">WordprocessingMLPackage</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// wordMLPackage -&gt; pdf os</span>
    <span class="token class-name">FOSettings</span> foSettings <span class="token operator">=</span> <span class="token class-name">Docx4J</span><span class="token punctuation">.</span><span class="token function">createFOSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Mapper</span> fontMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IdentityPlusMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//字体处理</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文楷体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STKaiti&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;隶书&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;LiSu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;宋体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;微软雅黑&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft Yahei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;黑体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SimHei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;楷体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;KaiTi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;新宋体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;NSimSun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文行楷&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STXingkai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文仿宋&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STFangsong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;仿宋&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;FangSong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;幼圆&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;YouYuan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文宋体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STSong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文中宋&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STZhongsong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;等线&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;等线 Light&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文琥珀&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STHupo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文隶书&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STLiti&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文新魏&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STXinwei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文彩云&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STCaiyun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;方正姚体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;FZYaoti&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;方正舒体&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;FZShuTi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;华文细黑&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;STXihei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;宋体扩展&quot;</span><span class="token punctuation">,</span><span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;simsun-extB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;仿宋_GB2312&quot;</span><span class="token punctuation">,</span><span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;FangSong_GB2312&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fontMapper<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;新細明體&quot;</span><span class="token punctuation">,</span><span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//解决宋体（正文）和宋体（标题）的乱码问题</span>
    <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;PMingLiU&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;新細明體&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalFonts</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    wordMLPackage<span class="token punctuation">.</span><span class="token function">setFontMapper</span><span class="token punctuation">(</span>fontMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

    foSettings<span class="token punctuation">.</span><span class="token function">setWmlPackage</span><span class="token punctuation">(</span>wordMLPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    foSettings<span class="token punctuation">.</span><span class="token function">setApacheFopMime</span><span class="token punctuation">(</span><span class="token string">&quot;application/pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Docx4J</span><span class="token punctuation">.</span><span class="token function">toPDF</span><span class="token punctuation">(</span>wordMLPackage<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token class-name">PDFoutputFilePath</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>图片转码</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
  * 图片转码(如无法完成BASE64包的导入，查看编辑器是否开发BASE64包的使用)
  */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getImageStr</span><span class="token punctuation">(</span><span class="token class-name">String</span> imgpath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>imgpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>in<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">BASE64Encoder</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BASE64Encoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>模板制作</strong></p> <div class="language-properties extra-class"><pre class="language-properties"><code>1、打开word文档
2、在需要填充数据的地方添加变量————${变量名}
3、将word文档另存为XML格式
4、使用XML工具打开XML文件，查找添加的所有变量是否被分隔开，如果被分隔开，直接删除中间代码，保存XML文件
5、更改XML文件后缀为.ftl——模板制作完成
6、将.ftl文件放到工具类所在项目的src/main/resources/template目录下
</code></pre></div><h3 id="_2、文件上传服务器与服务器下载文件"><a href="#_2、文件上传服务器与服务器下载文件" aria-hidden="true" class="header-anchor">#</a> 2、文件上传服务器与服务器下载文件</h3> <p><strong>代码包：zyxhj.utils/JschOpenHandler</strong></p> <p><strong>使用JSCH实现</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 文件上传到服务器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.jcraft<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jsch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.1.54<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>基本属性值</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//默认等待时间</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEF_WAIT_SECONDS <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> HOST <span class="token operator">=</span> <span class="token string">&quot;47.99.209.235&quot;</span><span class="token punctuation">;</span><span class="token comment">// 服务器地址</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> USERNAME <span class="token operator">=</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span><span class="token comment">// 服务器登录名</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> PASSWORD <span class="token operator">=</span> <span class="token string">&quot;Aa123456Aa&quot;</span><span class="token punctuation">;</span><span class="token comment">// 服务器密码</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_PORT <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span><span class="token comment">//端口号</span>
</code></pre></div><p><strong>文件上传服务器</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token function">openSession</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> USERNAME<span class="token punctuation">,</span> PASSWORD<span class="token punctuation">,</span> DEF_WAIT_SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelShell</span> openChannelShell <span class="token operator">=</span> <span class="token function">openChannelShell</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    openChannelShell<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    openChannelShell<span class="token punctuation">.</span><span class="token function">setOutputStream</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelSftp</span> openChannelSftp <span class="token operator">=</span> <span class="token function">openChannelSftp</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 源文件地址</span>
        <span class="token class-name">String</span> sourcefile <span class="token operator">=</span> <span class="token string">&quot;C:\\Users\\Admin\\Desktop\\集体经济管理员账号.xlsx&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 放在服务器的目标位置</span>
        <span class="token class-name">String</span> DST_FILE_PATH <span class="token operator">=</span> <span class="token string">&quot;/var/jar/jititest/file-uploads/1001&quot;</span><span class="token punctuation">;</span>
      	<span class="token comment">// 首先查看下目录，如果不存在，系统会被错，捕获这个错，生成新的目录。</span>
		openChannelSftp<span class="token punctuation">.</span><span class="token function">ls</span><span class="token punctuation">(</span>DST_FILE_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">// 上传文件到服务器</span>
        openChannelSftp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>sourcefile<span class="token punctuation">,</span> DST_FILE_PATH<span class="token punctuation">,</span> <span class="token class-name">ChannelSftp</span><span class="token punctuation">.</span>OVERWRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭会话</span>
        <span class="token function">disConn</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> openChannelSftp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>服务器下载文件</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token function">openSession</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> USERNAME<span class="token punctuation">,</span> PASSWORD<span class="token punctuation">,</span> DEF_WAIT_SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelShell</span> openChannelShell <span class="token operator">=</span> <span class="token function">openChannelShell</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    openChannelShell<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    openChannelShell<span class="token punctuation">.</span><span class="token function">setOutputStream</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelSftp</span> openChannelSftp <span class="token operator">=</span> <span class="token function">openChannelSftp</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//文件保存位置</span>
        <span class="token class-name">String</span> downloadFileName <span class="token operator">=</span> <span class="token string">&quot;C:/Users/Admin/Desktop/123.xlsx&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//服务器文件目录</span>
        <span class="token class-name">String</span> downloadfilepath <span class="token operator">=</span> DST_FILE_PATH<span class="token punctuation">;</span>
        <span class="token comment">//服务器文件</span>
        <span class="token class-name">String</span> downloadfile <span class="token operator">=</span> <span class="token string">&quot;集体经济管理员账号.xlsx&quot;</span><span class="token punctuation">;</span>
        
         <span class="token comment">// 从服务器下载文件</span>
        <span class="token function">sftpDownLoadFile</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> downloadFileName<span class="token punctuation">,</span> downloadfilepath<span class="token punctuation">,</span> downloadfile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭会话</span>
        <span class="token function">disConn</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> openChannelSftp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3、二维码生成"><a href="#_3、二维码生成" aria-hidden="true" class="header-anchor">#</a> 3、二维码生成</h3> <p><strong>代码包：zyxhj.utils/QRCodeUtils</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 二维码生成 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.zxing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>使用方法：</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;二维码信息&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> imgPath <span class="token operator">=</span> <span class="token string">&quot;二维码嵌入图片地址&quot;</span>；
    <span class="token class-name">String</span> destPath <span class="token operator">=</span> <span class="token string">&quot;二维码保存地址&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Boolean</span> needCompress <span class="token operator">=</span> <span class="token string">&quot;是否压缩二维码&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">QRCodeUtil</span><span class="token punctuation">.</span><span class="token function">produceQRCode</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> imgPath<span class="token punctuation">,</span> destPath<span class="token punctuation">,</span> needCompress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4、腾讯云tim"><a href="#_4、腾讯云tim" aria-hidden="true" class="header-anchor">#</a> 4、腾讯云TIM</h3> <p><strong>基本属性值</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//腾讯云TIM——APPID</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> sdkappid <span class="token operator">=</span> <span class="token number">1400277699</span><span class="token punctuation">;</span>
<span class="token comment">//腾讯云TIM——秘钥</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;281d8830bb13fa0923bc5c34cc13690faac214906fd5342782daba5a3e645f3c&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//userSig有效时间</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> EXPIRETIME <span class="token operator">=</span> <span class="token number">604800000L</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>使用方法：</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//榴莲项目中的userSig由用户的userId生成</span>
    <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token number">11111111111L</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> userSig <span class="token operator">=</span> <span class="token class-name">TIMUtil</span><span class="token punctuation">.</span><span class="token function">genSig</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5、备注"><a href="#_5、备注" aria-hidden="true" class="header-anchor">#</a> 5、备注</h3> <div class="language-properties extra-class"><pre class="language-properties"><code>技术开发：郑兴江
技术维护：郑兴江
联系方式：1151484669(QQ)
项目保管：小红椒-刘滔
<span class="token attr-name">项目地址：</span> <span class="token attr-value">https://github.com/ahateam/zero/tree/dev</span>
是否维护：否/是
停止维护：2019/12/11
</code></pre></div><h2 id=""><a href="#" aria-hidden="true" class="header-anchor">#</a></h2></div> <!----> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/document/aha/front/vueUni.html" class="prev">
          前端技术文档示例
        </a></span> <span class="next"><a href="/document/aha/back/contentModule.html">
          内容模块文档/三方登录
        </a>
        →
      </span></p></div> </main> <div class="valine-wrapper" data-v-5029e45b><div id="valine" data-v-5029e45b></div></div></div> <div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-cd623d78 data-v-cd623d78><i class="iconfont reco-up" data-v-cd623d78></i></div></div></div></div><div class="global-ui"></div></div>
    <script src="/document/assets/js/app.3d2e3ff9.js" defer></script><script src="/document/assets/js/3.b3d74ef6.js" defer></script><script src="/document/assets/js/1.548067c8.js" defer></script><script src="/document/assets/js/17.57674d0d.js" defer></script>
  </body>
</html>
